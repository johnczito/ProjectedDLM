# ------------------------------------------------------------------------------
# load resources
# ------------------------------------------------------------------------------

source("helpers/_helpers.R")

# ------------------------------------------------------------------------------
# settings
# ------------------------------------------------------------------------------

TT = 10
n = 2
k = 5

set.seed(8675309)

# ------------------------------------------------------------------------------
# data
# ------------------------------------------------------------------------------

Y = matrix(rnorm(TT * n), TT, n)
X = matrix(rnorm(TT * k), TT, k)

# ------------------------------------------------------------------------------
# prior hyperparameters
# ------------------------------------------------------------------------------

v0 = n + 1
P0 = riwish(n + 5, diag(n))
B0 = matrix(rnorm(n * k), k, n)
invO0 = riwish(k + 5, diag(k))

# ------------------------------------------------------------------------------
# marginal likelihood
# ------------------------------------------------------------------------------

#mlparams = mvregmarginallikelihood(X, v0, P0, B0, invO0)
#df = mlparams$df
#Ybar = mlparams$Ybar
#U = mlparams$U
#V = mlparams$V

# ------------------------------------------------------------------------------
# posterior hyperparameters
# ------------------------------------------------------------------------------

newparams = mvregposterior(Y, X, v0, P0, B0, invO0)
v = newparams$v
P = newparams$P
B = newparams$B
invO = newparams$invO

# ------------------------------------------------------------------------------
# density evaluations
# ------------------------------------------------------------------------------

val = rmniw(v0, P0, B0, invO0)
G = val$B
W = val$S

logmdd = mvreglogmdd(n, v0, v, P0, P, invO0, invO)
loglike = mvregloglikelihood(Y, X, G, W)
logprior = dmniw(G, W, v0, P0, B0, invO0)
logpost = dmniw(G, W, v, P, B, invO)

c(loglike + logprior - logmdd, logpost)
